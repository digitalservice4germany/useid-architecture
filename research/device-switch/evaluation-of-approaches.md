# Evaluation of secure device switch approaches

The following lists approaches on how a secure device switch from one device (desktop) to another device (mobile)
as part of the eID flow could be realised. The approaches are evaluated regarding their impact on the security, 
effort to implement and impact on UX. 

## QR-Code with Phishing Mitigation

Implement the previous idea, but with additional security measures to lower attack vector / make an attack harder. A complete mitigation is not possible.

| Security Measure                                                                                             | Impact on Security                                                                                                                                  | Effort to implement                                                                             | Impact on UX                                                                                           |
|--------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------|
| **ReCaptcha** to prevent automation of attack                                                                | **High** - together with TBT                                                                                                                        | **Low** - Complete free to use solutions exist                                                  | **High** - ReCaptcha can be annoying for users if there is not enough data and user must solve “puzzle” |
| **Time-based Tokens** to prevent replaying a once manually prepared attack                                   | **High** - together with ReCaptcha                                                                                                                  | **Medium** - We must put some thoughts in it but the implementation should be straight forward  | **Low** - token might expire between scan and opening the app                                          |
| **Domain validation** by user to ensure a legit domain                                                       | **Low** - users do not read and fake domains might look the same                                                                                    | **Low** - Showing a warning to the user is enough                                               | **Low** - user must read the warning and manually compare domains                                      |
| **Automatic domain validation** to ensure a legit domain by scanning the screen via camera and detect domain | **Low** - image detection might fail                                                                                                                | **High** - Reliably detecting the domain will be hard                                           | **High** - most users do not want to scan/take a picture of their screen (no trust)                    |
| **TAN**: random value generated by app (or widget) and requested by widget (or app, resp.)                   | **Medium** - additional value that must be phished in realtime                                                                                      | **Medium** - Generating a random String and requesting it as input / must be implemented in App | **Low** - known pattern, low effort for user to read / input TAN                                       |
| [3d dotcloud](https://apple.stackexchange.com/questions/301563/what-is-the-technology-used-in-ios-11-settings-migration-moving-blue-dots-par/314552#314552) instead of static QA code                                                                    | **Medium** - Mitigates, that the attacker can not easily take a picture of the QR code (not easy to scan until there is an easy to use oss scanner) | **Medium** - scanning is hard to implement since it is not very wide spread yet                 | **Low** - no negativ impact, potentially a “cool” feature                                              |
| **Transaction Info** displayed in app to show users, for what they identify (see also banking TAN apps/sms)      | **High** - if users read this carefully and the information is useful, phishing is almost impossible                                                                                                                                         | **High** - for each eService, useful information needs to be thought of and the API needs to be adapted                                                                                     | **Low** - user just needs to read and validate the info                                                |
 
## QR-Code with refresh link via email (or SMS)

Implement the QR code idea with a different handling of the refresh address.

| Security Measure                                                                                                                                                                 | Impact on Security                                                                                                                                  | Effort to implement                                                                | Impact on UX                                                                                                                      |
|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------|
| The **refresh address** is not sent via SSE, because there is no secure connection between smartphone and desktop, but **sent via email**. User opens link on desktop and clicks link. | **High** - Phishing is (almost) impossible, because refresh address is not exposed to attacker, unless they have access to email.                                                                                                                        | **Medium** - Server “just” needs email endpoint. Problem: don’t become spam mailer | **Medium** - user must input email address (could be locally stored by app); user leaves app and must open mail on other device; but: known pattern (validation mail) |

## QR-Code with refresh address to be entered manually in desktop browser

The refresh address is displayed in app, users need to type it into their desktop browser.

| Security Measure                                          | Impact on Security                                                                                                                                  | Effort to implement                                                             | Impact on UX                                 |
|-----------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------|----------------------------------------------|
| the **refresh address is never transferred** via internet | **High** - phishing is (almost) impossible: an attack would need access to the screen / smartphone / computer                                                                                                                        | **Low** - just displaying the refresh address in the app | **Low** - error prone and annoying for users |

## User account instead of stateless QR code

The user needs to log into an account in the eService/widget and in the mobile app

| Security Measure                                             | Impact on Security                                                                                                                                       | Effort to implement                                                                                                     | Impact on UX                                                                                                                                                            |
|--------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **Implement user account with username / password**          | **Low** - an attacker could phish the credentials and would have full access to the account                                                              | **High** - A complete user account solution is required (registration, login, password reset, persistence, maintenance) | **High** - users need to have an account and need to be logged in to start identification - users need to remember credentials                                          |
| **Integrate with existing user account solution** (e.g. NKB) | **Low** - an attacker could phish the credentials and would have full access to the account                                                              | **Medium** - solution already exists, added integration and communication overhead                                      | **High** - users need to have an account and need to be logged in to start identification - users need to remember credentials; UX depending on UX of existing solution |
| **2FA / MFA** to strengthen security of user account          | **Medium** - current security “standard” for user accounts but can still be phished (fake website could request credentials and 2FA code and forward it) | **Medium** - Adding 2FA to an existing account solution is a common / well supported requirement                                                                                                          | **High** - second factor extends the user flow by another manual step                                                                                                   |
| **WebAuthn / Passkeys** as replacement for username / password + 2FA          | **High** - attacker would need to be in possession of your device(s)                                                             | **High** - not very wide spread, not too much open source software available | **High** - “passwordless” login on setup devices; devices need initial setup (device binding); (not all devices / browsers supported)                                                                         |

## Bluetooth / Wifi proximity proof

Verify that desktop computer and smartphone are close to each other using bluetooth and / or WiFi.

| Security Measure                                                                                  | Impact on Security                                                                                                                                  | Effort to implement                                       | Impact on UX                                 |
|---------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------|----------------------------------------------|
| proof that **both devices are at the same location** (hence used by the same user at the same time) | **High** - binding between users' devices mitigates phishing                                                                                                                        | **High** - research needed (how does it work? are  (all) browsers supported? is bluetooth access on smartphones open enough?) | **Low** - if done good, users won’t notice that this happens in background. might be error prone, so that it disrupts the flow. |

## WebAuthn

Transmit the refresh address from smartphone to desktop by using WebAuthn

Try the technology on [webauthn.io](https://webauthn.io).

**Register** via smartphone and some username.
**Auth** on your desktop using the same username.

| Security Measure                                                                                                                                                                                   | Impact on Security                                                                                                                                  | Effort to implement                                       | Impact on UX                                                                                                                       |
|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------|
| Proximity check: proof that **both devices are at the same location** (hence used by the same user at the same time) **OR** same user check: proof that both devices share their platform keychain | **High** - binding between users' devices mitigates phishing                                                                                                                        | **High** - bleeding edge technology, prototype has to be built to research limitations | **Medium** - WebAuthn flow is new to the user due to early adaption. System dialogs are not easily comprehensible (WebAuthn is primarily used for account login, but ideally the user would not even notice that they are creating an account). Adds another scan of a qr code. |
